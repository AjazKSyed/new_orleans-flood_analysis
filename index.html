<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="description" content="New Orleans Flood Analysis" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport"
    content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>New Orleans Flood Analysis</title>
  <link rel="icon" type="image/x-icon" href="/img/favicon.ico">

  <link rel="stylesheet" href="css/main.css">
  <script src="https://unpkg.com/scrollama"></script>
  <script
    src="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.js"></script>
</head>

<body>

  <section id="cover"
    style="background: url('https://19thnews.org/wp-content/uploads/2021/10/louisiana-hurricane_2jpg.jpg') no-repeat center center;  background-size: cover;">

    <div id="intro">
      <h1>New Orleans Flood Analysis</h1>
      <h4>About the Project</h4>
      <p style="text-align: center">
        summary of the project (purpose and what the goal is)
      </p>
      <h5>
        Team Members </h5>
      <div
        style="display: flex; flex-direction: row; justify-content: space-between;">
        <div id="bio">
          <img id="about"
            src='https://avatars.githubusercontent.com/u/59899413?v=4' /></img>
          <h6 >
            Ajaz Syed <br><br> Senior in Geography</h6>
        </div>
        <div id="bio">
          <img id="about"
            src='https://avatars.githubusercontent.com/u/43830158?v=4' /></img>
          <h6 >
            Maxwell James <br><br> Student in Geography</h6>
        </div>

        <div id="bio">
          <img id="about"
            src='https://avatars.githubusercontent.com/u/59627538?v=4' /></img>
          <h6>
            Emeka Emeche <br><br> Student in Geography</h6>
        </div>
        <div id="bio">
          <img id="about"
            src='https://avatars.githubusercontent.com/u/102634353?v=4' /></img>
          <h6 >
            Alyssa Havens <br><br> Student in Geography</h6>
        </div>
        <div id="bio">
          <img id="about"
            src='https://avatars.githubusercontent.com/u/75300297?v=4' /></img>
          <h6 >
            Lee David <br><br> Student in Geography</h6>
        </div>

      </div>



    </div>
  </section>

  <section id="damage_section">
    <div id="intro2">
      <h1>Hurricane Damage</h1>
      <div id="chunks">
        <h3>Hurricane Katrina (2005) </h3>
        <img id="chuck_img" src='img/KatrinaBefore.png'
          alt='Hurricane Katrina Before Image' /></img>
        <img id="chuck_img" src='img/KatrinaAfter.png'
          alt='Hurricane Katrina After Image' /></img>
      </div>
      <br>
      <div id="chunks">
        <h3>Hurricane Ida (2021) </h3>
        <img id="chuck_img2" src='img/IdaBefore.png'
          alt='Hurricane Ida Before Image' /></img>
        <img id="chuck_img2" src='img/IdaAfter.png'
          alt='Hurricane Ida After Image' /></img>

      </div>
      <div class="footnote">
        <span> Image attribution links <br></span><br>
        <a target="_blank"
          href="https://weather.com/storms/hurricane/news/2021-08-31-hurricane-ida-aerial-images-before-and-after">Hurricane
          Ida Images</a><br>
        <a target="_blank"
          href="https://globalnews.ca/news/2190704/hurricane-katrina-before-and-after-photos-show-rebuilt-neighbourhoods/">Hurricane
          Katrina Images</a>

      </div>

    </div>

  </section>


  <!-- a geonarrative will have two major components, a storyboard and a script panel of a series of scenes/actions -->
  <section id="geonarrative">
    <div id="storyboard">
      <!-- create the place holder element for map -->
      <nav id="menu"></nav>

      <div id="map"></div>

      <div class="map-overlay" id="legend"></div>

    </div>

    <article class="scene" data-scene="0">
      <h2>What happens in an emergency?</h2>
      <p>
        What happens in an emergency is that people would go to emergency
        shelters. This is most feasible when
        there isn't a safe route out of town due to debris, traffic, or not
        having a reliable means of transportation.
        The next option is to get out of town by car which is the most preferred
        option to take. This makes it so that people can be out of danger from
        the flooding or other natural occurences and into a safer place. New
        Orleans requires their citizens
        to evacuate out of town, they even have bus systems and other means of
        transportation provided by the city
        if people don't have cars. The current hurricane measures in place right
        now are the implementation of levees.
        Levees are a type of barrier that prevent the excess amounts of water
        from flooding the city from the coastline.
        Though there were a lot installed along the coastline, most of them have
        failed causing a sizable amount of water
        to flood New Orleans. They are also strengthening systems like pumps,
        floodwalls, floodgates, and home elevation
        to improve the brittle structure of New Orleans, and by extension,
        Lousiana.
      </p>
    </article>
    <article class="scene" data-scene="1">
      <h2>Demographics Comparison</h2>

    </article>
    <article class="scene" data-scene="2">
      <h2>Flood Risk</h2>
      <p>New Orleans is situated near the Gulf of Mexico and relatively close to
        sea level, with average elevation estimates ranging close to 3 ft above
        sea level. This makes the city particularly vulnerable to the storm
        systems formed in the gulf. The high winds and low-pressure weather
        systems that come with these storms cause sea levels to rise and waves
        to form, resulting in a phenomena known as storm surge that causes
        violent flooding in low elevation coastal areas. Though New Orleans has
        preventative measures such as the levee system in place to protect
        against storm surge tides, the city has flooded multiple times as a
        result of hurricanes making landfall in the region. Before Hurricane
        Katrina devastated New Orleans in 2005, city models estimated flood
        levels could reach up to 18 feet (5.5m) above sea level, and afterwards
        it was proven they could reach up to 30 feet (9.1m) above. Furthermore,
        the onset of global warming is causing more extreme weather events
        around the world, meaning these flood levels may increase in the
        future.<br>Keeping this in mind, we have developed elevational risk
        zones in the city of New Orleans. Our risk zones are divided into four
        categories: Low, Moderate, High, and Severe. Buildings and plots of land
        that are at or below 1 meter (3.3ft) above sea level are designated as
        severe. Plots at or below 4 meters (13.1ft) are designated as high.
        Plots at or below 9 meters (29.5ft) are moderate, and those above 9
        meters (29.5ft) above sea level are designated as low. The decision to
        use these measures as divisions was derived as follows: The division
        between moderate and low was made to revolve around the highest flood
        level to date (during Hurricane Katrina) at about 30 feet. Moderate
        plots are designated where it has been proven possible flood damage can
        occur or has occurred at a similar elevation in the past and damage is
        only likely from large storm systems similar to Katrina. Low risk plots
        are designated as such because though they have likely not been damaged
        due to past flooding, larger storm systems exacerbated by global warming
        could damage them in the future. For the division between moderate and
        high risk, multiple factors were considered including the 18-foot
        previous maximum flood level estimate, as well as multiple floods taking
        place before and after, and the levee system of New Orleans. High risk
        plots are designated as those almost certain to be damaged if storm
        surge overtops the levee system, and moderate again as those likely to
        be damaged only by unusually large storms. Finally, the division between
        high and severe falls at 1 meter, and severe plots are those that are
        likely to be damaged by any sort of flooding in that area of New
        Orleans, even if levees are not fully overtopped.</p>
    </article>
    <article class="scene" data-scene="3">
      <h2>Current Plans</h2>




      <img id="items"
        src='https://upload.wikimedia.org/wikipedia/commons/thumb/b/b2/New_Orleans_Elevations.jpg/1920px-New_Orleans_Elevations.jpg' /></img><br>
      <div class="footnote">

        <a target="_blank"
          href="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b2/New_Orleans_Elevations.jpg/1920px-New_Orleans_Elevations.jpg">From
          Wikimedia</a>
      </div>
    </article>


  </section>

  <section id="footer">
    <h2>FOOTER</h2>
  </section>


  <script>

    let map, scriptPanel = scrollama();


    history.scrollRestoration = "manual";
    window.scrollTo(0, 0);
    adjustStoryboardlSize();
    window.addEventListener("resize", adjustStoryboardlSize);

    function adjustStoryboardlSize() {

      const scenes = document.getElementsByClassName("scene");
      const storyboard = document.getElementById("storyboard");

      let sceneH = Math.floor(window.innerHeight * 0.75);
      for (const scene of scenes) {
        scene.style.height = sceneH + "px";
      }

      let storyboardHeight = window.innerHeight;
      let storyboardMarginTop = (window.innerHeight - storyboardHeight) / 2;

      storyboard.style.height = storyboardHeight + "px";
      storyboard.style.top = storyboardMarginTop + "px"

      scriptPanel.resize();
    }

    mapboxgl.accessToken =
      'pk.eyJ1IjoiYWphemtzeWVkIiwiYSI6ImNrd3plcWVsaTA0azkybm1wZ3c5MnB1OGcifQ.91la4ZENVFAgHfVaXoKjOw'; // Assign the access token

    map = new mapboxgl.Map({
      container: 'map', // container ID
      style: 'mapbox://styles/mapbox/light-v10',
      zoom: 10.62, // starting zoom
      minZoom: 3,
      maxZoom: 18,
      center: [-89.941, 29.957], // starting center
      scrollZoom: false,
      boxZoom: false,
      doubleClickZoom: true
    });


    async function geojsonFetch() {

      let response, population20, income19, evac_spots;

      response = await fetch("assets/income(2019).geojson");
      income19 = await response.json();


      response = await fetch("assets/population(2020).geojson");
      population20 = await response.json();


      response = await fetch("assets/evacuation.geojson");
      evac_spots = await response.json();


      map.on('load', () => {

        map.addSource('income19-src', {
          type: 'geojson',
          data: income19,
          attribution: 'Layer designed by Ajaz Syed'

        });
        map.addSource('population20-src', {
          type: 'geojson',
          data: population20,
          attribution: 'Layer designed by Ajaz Syed'

        });

        map.addSource('riskmap-src', {
          'type': 'raster',
          'tiles': [
            'assets/tiles/riskmap_final/{z}/{x}/{y}.png'
          ],
          'tileSize': 256,
          'attribution': 'Map tiles designed by Max Jayne'
        });

        map.loadImage(
          'img/shelter_icon.png',
          (error, image) => {
            if (error) throw error;
            map.addImage('custom-marker', image);
            // Add a GeoJSON source with 2 points
            map.addSource('evac-src', {
              type: 'geojson',
              data: evac_spots,
              attribution: 'Layer created and designed by Ajaz Syed'

            });
          });




        evacLayer = {
          'id': 'evac_points',
          'type': 'symbol',
          'source': 'evac-src',
          'layout': {
            'icon-image': 'custom-marker',

          }
        };


        population20Layer = {
          'id': 'population20-polygons',
          'type': 'fill',
          'source': 'population20-src',
          'layout': {
            'visibility': 'visible'
          },
          paint: {
            'fill-color': [
              'step',
              ['get', 'population'],
              '#ffffb2',
              1000,
              '#ffd76d',
              2000,
              '#fea649',
              3000,
              '#f86c30',
              4000,
              '#e62f21',
              5000,
              '#bd0026',

            ],
            'fill-outline-color': '#BBBBBB',
          },

        };


        income19Layer = {
          'id': 'income19-polygons',
          'type': 'fill',
          'source': 'income19-src',
          'layout': {
            'visibility': 'visible'
          },
          paint: {
            'fill-color': [
              'step',
              ['get', 'income'],
              '#f7fcf5',
              10,
              '#ddf2d7',
              10000,
              '#b2e0ab',
              32000,
              '#7bc87c',
              56000,
              '#3da75a',
              87000,
              '#137e3a',
              125000,
              '#00441b',

            ],
            'fill-outline-color': '#BBBBBB',
          },

        };

        riskLayer = {
          'id': 'risk-plots',
          'type': 'raster',
          'source': 'riskmap-src'
        };

        scriptPanel
          .setup({
            step: ".scene", // all the scenes.
            offset: 0.5, // the location of the enter and exit trigger
            debug: false
          })
          .onStepEnter(handleSceneEnter)
          .onStepExit(handleSceneExit);

        function handleSceneEnter(response) {

          var index = response.index; // capture the id of the current scene.
          document.getElementById("legend").style.visibility = "hidden";

          if (index === 0) { // When enter the first scene

            map.flyTo({
              center: [-90.030, 29.976],
              zoom: 12.20,
              pitch: 0,
            });

            if (typeof (map.getSource('evac-src')) == 'undefined') {
              map.addSource('evac-src', {
                type: 'geojson',
                data: evac_spots,
                attribution: 'Layer created and designed by Ajaz Syed'
              });
            } else {
              map.getSource('evac-src')

            }

            if (!map.getLayer("evac_points")) {
              map.addLayer(evacLayer);
            }


            document.getElementById("damage_section").style.visibility = "hidden"; // Hide the cover page

            document.getElementById("cover").style.visibility = "hidden"; // Hide the cover page

          } else if (index === 1) { // When enter the second scene.


            map.flyTo({
              center: [-89.941, 29.957],
              zoom: 10.62, // starting zoom
              pitch: 0,
            });
            const pop_layers = [
              '<1000',
              '1000-1999',
              '2000-2999',
              '3000-3999',
              '4000-4999',
              '5000+'
            ];

            const pop_colors = [
              '#ffffb2',
              '#ffd76d',
              '#fea649',
              '#f86c30',
              '#e62f21',
              '#bd0026'
            ];


            const inc_layers = [
              'No data',
              '<$10,000',
              '$10,000 - $31,999',
              '$32,000 - $55,999',
              '$56,000 - $86,999',
              '$87,000 - $124,999',
              '$125,000+'
            ];

            const inc_colors = [
              '#f7fcf5',
              '#ddf2d7',
              '#b2e0ab',
              '#7bc87c',
              '#3da75a',
              '#137e3a',
              '#00441b'
            ];
            map.addLayer(population20Layer);
            map.addLayer(income19Layer);

            document.getElementById("menu").style.visibility = "visible";
            if (!map.getLayer('population20-polygons') || !map.getLayer('income19-polygons')) {
              return;
            }

            const toggleableLayerIds = ['population20-polygons', 'income19-polygons'];

            for (const id of toggleableLayerIds) {
              if (document.getElementById(id)) {
                continue;
              }
              const link = document.createElement('a');
              link.id = id;
              link.href = '#';
              link.textContent = id;
              link.className = 'active';

              // Show or hide layer when the toggle is clicked.
              link.onclick = function (e) {
                const clickedLayer = this.textContent;
                e.preventDefault();
                e.stopPropagation();

                const visibility = map.getLayoutProperty(
                  clickedLayer,
                  'visibility'
                );

                // Toggle layer visibility by changing the layout object's visibility property.
                if (visibility === 'visible') {
                  map.setLayoutProperty(clickedLayer, 'visibility', 'none');

                  this.className = '';
                } else {
                  this.className = 'active';
                  map.setLayoutProperty(
                    clickedLayer,
                    'visibility',
                    'visible'
                  );
                  if (clickedLayer == 'population20-polygons') {
                    document.getElementById("legend").style.visibility = "visible";

                    const legend = document.getElementById("legend");
                    legend.innerHTML = "<b>Population (2020)</b><br><br>";


                    pop_layers.forEach((layer, i) => {
                      const color = pop_colors[i];
                      const item = document.createElement('div');
                      const key = document.createElement('span');
                      key.className = 'legend-key';
                      key.style.backgroundColor = color;

                      const value = document.createElement('span');
                      value.innerHTML = `${layer}`;
                      item.appendChild(key);
                      item.appendChild(value);
                      legend.appendChild(item);
                    });
                  } else {
                    document.getElementById("legend").style.visibility = "visible";

                    const legend = document.getElementById("legend");
                    legend.innerHTML = "<b>Average Household Income (2019)</b><br><br>";


                    inc_layers.forEach((layer, i) => {
                      const color = inc_colors[i];
                      const item = document.createElement('div');
                      const key = document.createElement('span');
                      key.className = 'legend-key';
                      key.style.backgroundColor = color;

                      const value = document.createElement('span');
                      value.innerHTML = `${layer}`;
                      item.appendChild(key);
                      item.appendChild(value);
                      legend.appendChild(item);
                    });
                  }
                }


              };

              const layers = document.getElementById('menu');
              layers.appendChild(link);
            }



          } else if (index === 2) {
            map.flyTo({
              center: [-90.007, 29.992],
              zoom: 11.91,
            });
            const risk_layers = [
              'Low (<=1m above sea level)',
              'Moderate (<=4m above sea level)',
              'High (<=9m above sea level)',
              'Severe (>9m above sea level)'
            ];

            const risk_colors = [
              '#ff4901',
              '#ffaf01',
              '#ffea01',
              '#19fe00'
            ];

            if (typeof (map.getSource('riskmap-src')) == 'undefined') {
              map.addSource('riskmap-src', {
                type: 'raster',
              });
            } else {
              map.getSource('riskmap-src')

            }

            if (!map.getLayer("risk-plots")) {
              map.addLayer(riskLayer);
            }

            document.getElementById("legend").style.visibility = "visible";

            const legend = document.getElementById("legend");
            legend.innerHTML = "<b>Risk Levels</b><br><br>";


            risk_layers.forEach((layer, i) => {
              const color = risk_colors[i];
              const item = document.createElement('div');
              const key = document.createElement('span');
              key.className = 'legend-key';
              key.style.backgroundColor = color;

              const value = document.createElement('span');
              value.innerHTML = `${layer}`;
              item.appendChild(key);
              item.appendChild(value);
              legend.appendChild(item);
            });

          } else if (index === 3) {
            map.flyTo({
              center: [-89.941, 29.957],
              zoom: 10.5,

            });


          }
          else if (index === 4) {

            map.flyTo({
              center: [-89.941, 29.957],
              zoom: 10.62,
              pitch: 0,

            });


          }
        }

        function handleSceneExit(response) {
          var index = response.index;

          if (index === 0) {

            if (response.direction == 'down') {
              document.getElementById("cover").style.visibility = "hidden";
              document.getElementById("damage_section").style.visibility = "hidden";

            } else {
              document.getElementById("cover").style.visibility = "visible";
              document.getElementById("damage_section").style.visibility = "visible";

            }
            if (map.getLayer("evac_points")) {
              map.removeLayer('evac_points');
            }
          } else if (index === 1) {
            if (map.getLayer("population20-polygons")) {
              map.removeLayer('population20-polygons');
            }
            if (map.getLayer("income19-polygons")) {
              map.removeLayer('income19-polygons');

            }
            document.getElementById("menu").style.visibility = "hidden";

          } else if (index === 2) {

            if (map.getLayer("risk-plots")) {
              map.removeLayer('risk-plots');
            }
          } else if (index === 3) {

          }
        }


      });

    };
    geojsonFetch();
  </script>
</body>

</html>